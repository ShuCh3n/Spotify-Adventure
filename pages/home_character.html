<script>
    $(function(){
        var spotifyUSR = $.session.get("spotifyUSR");

        var heroInfo = getSingleHeroInfo(0, spotifyUSR);
        var obj = $.parseJSON(heroInfo);

        var id;
        var name;
        var gender;
        var level;
        var exp;

        $.each(obj, function() {
            hero_id = this['id'];
            name = this['name'];
            gender = this['gender'];
            level = this['level'];
            exp = this['exp'];
            gold = this['gold'];
        });

        var next_level = parseInt(level) + 1;

        var next_level_exp = nextLevelExp(next_level);

        $("#hero_name").html(name);
        $("#hero_level").html(level);
        $("#hero_exp").html(exp + "/" + next_level_exp);
        $("#hero_gold").html(gold);

        $("#switchCharacter").click(function(){
            $("body").load("pages/switch_character.html");
        });

        $("#createNewCharacter").click(function(){
            $("body").load("pages/create_character.html");
        });

        setInterval(function() {
            getCurrentPlayerInfo(function(playing, position, trackuri) {
                if(playing == true){
                    getTrackInfo(trackuri);
                    getArtistInfo(artist);

                    var returnExp = addExp(hero_id, next_level);

                    var heroInfo = getSingleHeroInfo(0, spotifyUSR);
                    var obj = $.parseJSON(heroInfo);

                    var exp;

                    $.each(obj, function() {
                        exp = this['exp'];
                    });

                    $("#hero_exp").html(exp + "/" + next_level_exp);

                    if(returnExp == 1){
                        level = parseInt(level) + 1;
                        next_level = parseInt(level) + 1;
                        next_level_exp = nextLevelExp(next_level);
                        $("#hero_level").html(level);
                    }
                }
            });
        }, 5000);

        //If there is a quest availible show quest button
		displayQuestButton(hero_id);

        //Show quest list
        $("#quest_button").click(function(){
            $( ".quest_popup" ).fadeIn("slow");
        });

        //Close quest list
        $("#close_questlist").click(function(){
            $( ".quest_popup" ).fadeOut("slow");
        });
    });
</script>

<div class="bgcontainer">
    <div class="clouds"></div>
</div>

<div class="hero"><img src="images/hero.gif"></div>
<div class="ground"></div>
<hr>

<div class="characterInfo">
    <span>Hero name: </span><span  id="hero_name"></span><br />
    <span>Level: </span><span  id="hero_level"></span><br />
    <span>Exp: </span><span  id="hero_exp"></span><br />
    <span>Gold: </span><span  id="hero_gold"></span><br />
</div>

<div class="charactMenu">
    
    <p id="quest_button"></p>
    <a href="#" id="switchCharacter">Switch Character</a>
    <a href="#" id="createNewCharacter">Create New Character</a>
	
</div>

<div class="quest_popup">
    <script>
        var quest = getQuestList(hero_id);
        var obj = $.parseJSON(quest);
        var quest_list = "";

        $.each(obj, function() {
            quest_id = this['id'];
            level_req = this['level_req'];
            quest_title = this['title'];
            quest_desc =  this['description'];

            quest_list +=
                    "<div class='quest_row' id='row_" + quest_id + "'>" +
                            "<div class='quest_head' id='" + quest_id + "'>" +
                                quest_title +
                            "</div>" +
                    "</div>"+

                    "<div class='quest_description' id='quest_desc_" + quest_id + "'><i>" +
                            quest_desc+
                            " <button class='accept_quest' id='" + quest_id + "'>Accept</button>"+
                    "</i></div>"
            ;
        });

        $(".quest_list").html(quest_list);

        //Show quest description
        $(".quest_head").click(function(){
            var quest_id = $(this).attr('id');
            $( "#quest_desc_" + quest_id ).toggle("slow");
        });

        //Accept Quest
        $(".accept_quest").click(function(){
            var quest_id = $(this).attr('id');

            acceptQuest(hero_id, quest_id);
            $( "#quest_desc_" + quest_id).remove();
            $( "#row_" + quest_id ).remove();

        });
    </script>

    <div class="quest_list"></div>
    <button id="close_questlist">Close</button>
</div>